# PRD-03: Scriptify 三工作区系统

**版本**: v1.0
**日期**: 2025-10-29
**依赖**: PRD-01, PRD-02
**状态**: 草案

---

## 一、设计理念

### 1.1 为什么需要工作区?

不同发布平台对分镜脚本的要求**完全不同**:

| 平台类型 | 代表平台 | 核心差异 |
|---------|---------|---------|
| **传统漫画平台** | 快看漫画、腾讯动漫 | 横屏条漫,按话数分,重视分镜叙事 |
| **短视频平台** | 抖音、快手、B站 | 竖屏9:16,精确时间轴,配音对齐 |
| **动态漫画** | AE/剪映后期制作 | 完整运镜参数,导出到剪辑软件 |

**如果只用一套格式,会导致**:
- ❌ 漫画创作者需要手动删除视频相关的时间轴标注
- ❌ 视频创作者需要手动添加音频时长计算
- ❌ 后期制作人员需要手动转换参数格式

**解决方案**: 借鉴 **article-writer 的多工作区设计**,为不同平台提供专用规范。

---

## 二、三工作区总览

### 2.1 工作区对比

| 维度 | 📱 漫画工作区<br>(Comic) | 📹 短视频工作区<br>(ShortVideo) | 🎬 动态漫工作区<br>(Motion) |
|------|---------------------|--------------------------|----------------------|
| **目标平台** | 快看、腾讯动漫、微博动漫 | 抖音、快手、B站 | AE、剪映、达芬奇 |
| **画面比例** | 横屏(16:9或自由) | 竖屏(9:16) | 可配置 |
| **时间轴** | 无(按分镜数) | 精确到秒 | 精确到帧(24fps/30fps) |
| **对话处理** | 气泡/旁白 | 字幕 + 配音时长 | 字幕 + 音轨 |
| **运镜参数** | 简化(景别、角度) | 基础(景别、时长) | 完整(所有参数+导出) |
| **分镜数量** | 自由(通常20-40个/话) | 限制(15-30秒 = 8-12镜) | 自由 |
| **特殊要求** | 翻页节奏、气泡位置 | 前3秒Hook、BGM标注 | 图层管理、转场效果 |

### 2.2 工作区选择决策树

```
用户发起创作
  ↓
  最终发布平台?
  ├─ 漫画平台(快看/腾讯动漫/微博)
  │   → 📱 漫画工作区
  │
  ├─ 短视频平台(抖音/快手/B站)
  │   → 📹 短视频工作区
  │
  └─ 需要后期制作(AE/PR/剪映)
      → 🎬 动态漫工作区
```

### 2.3 自动检测规则

借鉴 article-writer 的 `workspace-config.json`,Scriptify 会自动检测工作区:

**检测优先级**:

1. **用户显式指定**
   ```bash
   $ scriptify /specify --workspace comic
   ```

2. **检查 brief.md 中的 platform 字段**
   ```yaml
   platform: douyin  # 自动选择"短视频工作区"
   ```

3. **检查项目目录结构**
   ```
   projects/my-comic/
   └── .scriptify/
       └── config.json  # { "workspace": "comic" }
   ```

4. **分析剧本特征**
   - 如果包含 "时长: XX秒" → 短视频工作区
   - 如果包含 "第X话" → 漫画工作区
   - 如果包含 "导出AE" → 动态漫工作区

5. **默认**: 漫画工作区

---

## 三、📱 漫画工作区 (Comic Workspace)

### 3.1 设计目标

**核心场景**: 专业漫画创作者在快看漫画、腾讯动漫等平台连载作品

**用户需求**:
- 标准化的分镜格式,方便团队协作
- 清晰的分话/分章节管理
- 气泡对话位置标注
- 翻页节奏控制

### 3.2 分镜脚本格式

#### 完整示例

```markdown
# 《暗巷谜案》第 1 话: 雨夜

**项目信息**:
- 作者: 张小漫
- 类型: 悬疑推理
- 目标平台: 快看漫画
- 工作区: 📱 漫画工作区
- 总分镜数: 28 个
- 预计页数: 18-20 页

**角色**:
- 李墨: 私家侦探,男,30岁,黑色风衣
- 神秘女子: 失踪者,女,25岁,红色长裙

---

## 分镜脚本

### 场景 1: 雨夜街头

**环境**: 城市街道,夜晚,下雨
**氛围**: 孤独、压抑
**分镜数**: 5 个

---

#### 分镜 1

**景别**: 远景 (Extreme Long Shot)
**角度**: 俯视 10°
**画面内容**:
- 城市街道全景,霓虹灯在雨水中倒影
- 主角李墨背影出现在画面右侧
- 街道空无一人,营造孤独感

**分镜构图**:
```
┌─────────────────────────────┐
│    [霓虹灯牌]               │
│                             │
│   [建筑]    [建筑]          │
│                             │
│                    [李墨]   │  ← 背影,偏右
│ ════════════════════════    │  ← 街道
│     (雨水倒影)              │
└─────────────────────────────┘
```

**气泡/旁白**:
- 旁白(顶部): "这是一个没有月亮的夜晚。"

**翻页位置**: 否(与下一镜在同一页)

**备注**: 使用暗色调,突出霓虹灯

---

#### 分镜 2

**景别**: 中景 (Medium Shot)
**角度**: 侧面平视
**画面内容**:
- 李墨侧面,雨水打湿风衣
- 表情凝重,眼神向前
- 背景虚化,突出人物

**气泡/旁白**: 无

**翻页位置**: 否

---

#### 分镜 3

**景别**: 特写 (Close-Up)
**角度**: 俯拍
**画面内容**:
- 手机屏幕特写,显示一张女子照片(红色长裙)
- 雨滴打在屏幕上

**气泡/旁白**: 无

**翻页位置**: 是(本镜作为上一页的最后一镜,制造悬念)

**备注**: 照片是重要线索,需清晰展示

---

#### 分镜 4

**景别**: 近景 (Close Shot)
**角度**: 正面,微仰视
**画面内容**:
- 李墨抬头,眼神警觉
- 视线看向画面外(暗示有异动)

**气泡/旁白**:
- 音效: "!!" (大字体,强调)

**翻页位置**: 否

---

#### 分镜 5

**景别**: 中景 (Medium Shot)
**角度**: 李墨的主观视角
**画面内容**:
- 黑影在巷子口一闪而过
- 巷子里漆黑,只有轮廓

**气泡/旁白**:
- 对话气泡(李墨): "谁?!"
- 气泡位置: 画面左上角

**翻页位置**: 是(本镜是场景结尾,翻页制造紧张感)

**备注**: 黑影只显示轮廓,不暴露身份

---

### 场景 2: 追逐

(后续场景...)

---

## 创作备注

**翻页节奏**:
- 第 1 页: 分镜 1-2 (开场,慢节奏)
- 第 2 页: 分镜 3 (特写,制造悬念)
- 第 3 页: 分镜 4-5 (转折,翻页)

**气泡设计**:
- 旁白使用矩形框,位于顶部或底部
- 对话气泡指向说话者
- 内心独白使用云朵状气泡

**配色方案**:
- 主色调: 暗蓝、灰黑
- 强调色: 霓虹灯(粉红、青色)
- 重要道具: 红色(女子照片)
```

### 3.3 工作区特有字段

**漫画工作区专属**:

| 字段 | 说明 | 示例 |
|------|------|------|
| `翻页位置` | 是否在此镜后翻页 | 是/否 |
| `气泡/旁白` | 对话气泡或旁白内容 | "李墨: 谁?!" |
| `气泡位置` | 气泡在画面中的位置 | 左上角/右下角 |
| `分镜构图` | ASCII艺术或文字描述 | 见上方示例 |
| `页数估算` | 该场景预计占多少页 | 2-3页 |

### 3.4 配置参数

**漫画工作区配置** (`workspaces/comic/config.json`):

```json
{
  "workspace": "comic",
  "platform": "kuaikan",
  "aspectRatio": "16:9",
  "readingDirection": "left-to-right",
  "pagingStyle": "scroll",

  "constraints": {
    "minShotsPerScene": 3,
    "maxShotsPerScene": 10,
    "minShotsPerEpisode": 20,
    "maxShotsPerEpisode": 50,
    "targetPagesPerEpisode": 15-25
  },

  "dialogStyle": {
    "bubble": true,
    "narration": true,
    "thoughtCloud": true
  },

  "exportFormats": [
    "markdown",
    "pdf",
    "psd-template"
  ]
}
```

### 3.5 命令适配

**漫画工作区专属命令**:

```bash
# 设置翻页点
$ scriptify /paging --scene 1 --after-shot 3

# 设计气泡位置
$ scriptify /bubble --shot 5 --position "left-top" --content "谁?!"

# 生成分页预览
$ scriptify /preview-pages

# 导出到PSD模板
$ scriptify /export --format psd --template kuaikan
```

---

## 四、📹 短视频工作区 (ShortVideo Workspace)

### 4.1 设计目标

**核心场景**: 短视频创作者在抖音、快手、B站制作剧情类漫画视频

**用户需求**:
- 竖屏 9:16 构图
- 精确的时间轴管理(配音对齐)
- 前 3 秒 Hook 设计
- 字幕和 BGM 标注
- 导出到剪映/PR

### 4.2 分镜脚本格式

#### 完整示例

```markdown
# 职场小剧场 - 第 5 集: 老板的神逻辑

**项目信息**:
- 作者: 李视频
- 类型: 喜剧/职场
- 目标平台: 抖音
- 工作区: 📹 短视频工作区
- 画面比例: 9:16 (1080×1920)
- 总时长: 28 秒
- 分镜数: 7 个

**音频规划**:
- BGM: 轻快音乐(0:00-0:28)
- 配音: 真人配音 or AI 配音
- 音效: 3 处(见分镜标注)

**字幕样式**:
- 字体: 思源黑体 Bold
- 颜色: 白色,黑色描边
- 位置: 画面中下部

---

## 分镜脚本

### 场景 1: 办公室

**环境**: 现代办公室,白天
**角色**: 小明(员工)、老板
**总时长**: 28 秒

---

#### 【分镜 1】开场 Hook

**时间轴**: 00:00 - 00:03 (3秒)
**景别**: 中景 (Medium Shot)
**角度**: 平视,微仰
**构图方向**: 竖屏 9:16

**画面内容**:
- 小明战战兢兢站在老板办公桌前
- 老板低头看文件,气场强大
- 构图: 老板占画面下半部,小明占上半部

**字幕**: "打工人的日常崩溃..."
- 字幕位置: 画面顶部 1/4 处
- 字幕动画: 逐字出现

**配音**: 无
**BGM**: 0:00 开始,轻快音乐,音量 60%
**音效**: 无

**⏰ 前 3 秒 Hook**: ✅ 通过字幕和画面制造悬念

**竖屏构图示意**:
```
┌─────────┐
│  字幕   │ ← 顶部 1/4
├─────────┤
│ [小明]  │ ← 上半部,紧张表情
│         │
├─────────┤
│ [老板]  │ ← 下半部,低头看文件
│ [办公桌] │
└─────────┘
```

---

#### 【分镜 2】小明请假

**时间轴**: 00:03 - 00:07 (4秒)
**景别**: 近景 (Close Shot)
**角度**: 正面平视
**构图方向**: 竖屏 9:16

**画面内容**:
- 小明的脸部特写,表情纠结
- 嘴唇微动(说话状态)

**对话**:
- 小明: "老板,我明天想请假。"
- 对话时长: 2.5 秒

**字幕**: "老板,我明天想请假。"
- 字幕位置: 画面中下部
- 字幕时长: 00:03 - 00:07 (与对话同步)

**配音**:
- 音色: 男声,略显紧张
- 语速: 正常
- 情绪: 小心翼翼

**BGM**: 持续,音量降至 40%(突出对话)

---

#### 【分镜 3】老板反应

**时间轴**: 00:07 - 00:10 (3秒)
**景别**: 近景 (Close Shot)
**角度**: 微俯视
**构图方向**: 竖屏 9:16

**画面内容**:
- 老板抬头,眼神犀利
- 表情严肃

**对话**: 无(只有表情)

**字幕**: 无

**配音**: 无

**音效**: "咚!" (强调音效,0.5秒)

**BGM**: 突然停止(制造紧张感)

**备注**: 此镜用沉默制造张力

---

#### 【分镜 4】老板的神逻辑

**时间轴**: 00:10 - 00:15 (5秒)
**景别**: 中景 (Medium Shot)
**角度**: 平视
**构图方向**: 竖屏 9:16

**画面内容**:
- 老板半身,手指敲桌子
- 表情严肃但理所当然

**对话**:
- 老板: "明天? 那你今天就要干两天的活!"
- 对话时长: 3.5 秒

**字幕**: "明天? 那你今天就要干两天的活!"
- 字幕位置: 画面中下部
- 字幕样式: 关键词"两天"加粗 + 红色

**配音**:
- 音色: 男声,严肃
- 语速: 正常
- 情绪: 理直气壮

**BGM**: 重新开始,音量 50%

---

#### 【分镜 5】小明懵了

**时间轴**: 00:15 - 00:18 (3秒)
**景别**: 特写 (Close-Up)
**角度**: 正面平视
**构图方向**: 竖屏 9:16

**画面内容**:
- 小明脸部特写,表情从震惊到困惑
- 嘴巴微张,眼睛瞪大

**对话**:
- 小明: "???"

**字幕**: "???"
- 字幕位置: 画面顶部
- 字幕动画: 从小到大弹出

**配音**: 无(用表情表达)

**音效**: "啊?" (困惑音效,1秒)

**BGM**: 音量降至 30%

---

#### 【分镜 6】老板继续解释

**时间轴**: 00:18 - 00:24 (6秒)
**景别**: 中景 (Medium Shot)
**角度**: 平视
**构图方向**: 竖屏 9:16

**画面内容**:
- 老板双手交叉,一脸理所当然
- 背景虚化

**对话**:
- 老板: "明天你不在,今天就要提前做完明天的工作啊!"
- 对话时长: 4.5 秒

**字幕**: "明天你不在,今天就要提前做完明天的工作啊!"
- 字幕位置: 画面中下部
- 字幕样式: 正常

**配音**:
- 音色: 男声
- 语速: 正常
- 情绪: 讲道理的语气

**BGM**: 音量 50%

---

#### 【分镜 7】小明内心崩溃

**时间轴**: 00:24 - 00:28 (4秒)
**景别**: 特写 (Close-Up)
**角度**: 正面平视
**构图方向**: 竖屏 9:16

**画面内容**:
- 小明脸部特写,内心崩溃
- 表情: 无奈 + 想哭

**对话**:
- 小明(内心OS): "这什么神逻辑..."
- 对话时长: 2.5 秒

**字幕**: "这什么神逻辑..."
- 字幕位置: 画面中下部
- 字幕样式: 斜体,表示内心独白

**配音**:
- 音色: 男声,无奈
- 语速: 稍慢
- 情绪: 崩溃

**音效**: "叹气声" (1秒)

**BGM**: 逐渐淡出

**转场**: 淡出到黑屏,显示 "关注更新" 字样

---

## 时间轴总览

| 分镜 | 时间段 | 时长 | 内容 |
|------|--------|------|------|
| 1 | 00:00-00:03 | 3s | 开场 Hook |
| 2 | 00:03-00:07 | 4s | 小明请假 |
| 3 | 00:07-00:10 | 3s | 老板抬头 |
| 4 | 00:10-00:15 | 5s | 老板神逻辑 |
| 5 | 00:15-00:18 | 3s | 小明懵了 |
| 6 | 00:18-00:24 | 6s | 老板解释 |
| 7 | 00:24-00:28 | 4s | 小明崩溃 |
| **总计** | | **28s** | |

---

## 音频配置

**BGM**:
- 文件: 轻快音乐.mp3
- 时长: 0:00 - 0:28
- 音量变化:
  - 0:00-0:03: 60%
  - 0:03-0:07: 40%(对话)
  - 0:07-0:10: 0%(停止)
  - 0:10-0:28: 50%,最后淡出

**音效**:
- 0:07: "咚!" (强调)
- 0:15: "啊?" (困惑)
- 0:26: "叹气声"

**配音**:
- 共 4 段对话
- 总时长: 12.5 秒
- 配音风格: 夸张,喜剧感

---

## 导出配置

**导出到剪映**:
```json
{
  "resolution": "1080x1920",
  "fps": 30,
  "clips": [
    {"id": 1, "start": 0, "duration": 3, "image": "shot-01.png"},
    {"id": 2, "start": 3, "duration": 4, "image": "shot-02.png"},
    ...
  ],
  "subtitles": [
    {"text": "打工人的日常崩溃...", "start": 0, "end": 3},
    {"text": "老板,我明天想请假。", "start": 3, "end": 7},
    ...
  ],
  "audio": {
    "bgm": "轻快音乐.mp3",
    "voiceover": "配音.mp3"
  }
}
```
```

### 4.3 工作区特有字段

**短视频工作区专属**:

| 字段 | 说明 | 示例 |
|------|------|------|
| `时间轴` | 精确到秒的时间范围 | 00:03 - 00:07 |
| `时长` | 该镜头的持续时间 | 4秒 |
| `构图方向` | 固定为竖屏 9:16 | 竖屏 9:16 |
| `对话时长` | 配音需要的时间 | 2.5秒 |
| `字幕` | 屏幕字幕内容和样式 | "老板,我明天想请假。" |
| `字幕位置` | 字幕在画面中的位置 | 画面中下部 |
| `配音` | 配音的音色、语速、情绪 | 男声,紧张 |
| `BGM` | 背景音乐的音量变化 | 音量 40% |
| `音效` | 特殊音效 | "咚!" (0.5秒) |
| `转场` | 镜头过渡效果 | 淡出 |

### 4.4 配置参数

**短视频工作区配置** (`workspaces/short-video/config.json`):

```json
{
  "workspace": "short-video",
  "platform": "douyin",
  "aspectRatio": "9:16",
  "resolution": "1080x1920",
  "fps": 30,

  "constraints": {
    "minDuration": 10,
    "maxDuration": 60,
    "idealDuration": 25-35,
    "hookDuration": 3,
    "minShots": 5,
    "maxShots": 15
  },

  "audio": {
    "bgmRequired": true,
    "voiceoverRequired": false,
    "soundEffects": true
  },

  "subtitles": {
    "required": true,
    "position": "center-bottom",
    "style": "bold-outline"
  },

  "exportFormats": [
    "markdown",
    "剪映-json",
    "pr-xml",
    "ae-jsx"
  ]
}
```

### 4.5 命令适配

**短视频工作区专属命令**:

```bash
# 计算总时长
$ scriptify /duration

# 调整时间轴
$ scriptify /timeline --shot 4 --duration 3

# 添加字幕
$ scriptify /subtitle --shot 2 --text "老板,我明天想请假。"

# 生成配音脚本
$ scriptify /voiceover

# 导出到剪映
$ scriptify /export --format 剪映
```

---

## 五、🎬 动态漫工作区 (Motion Workspace)

### 5.1 设计目标

**核心场景**: 后期制作人员,需要将分镜导入 AE/PR/剪映进行动态漫画制作

**用户需求**:
- 完整的运镜参数(推拉摇移 + 速度)
- 图层管理(前景/中景/背景)
- 精确到帧的时间轴(24fps/30fps)
- 转场效果标注
- 导出为后期软件脚本

### 5.2 分镜脚本格式

#### 完整示例

```markdown
# 《都市修仙传》第 1 话 - 动态漫版本

**项目信息**:
- 作者: 王作家
- 类型: 玄幻/动作
- 目标平台: B站动态漫
- 工作区: 🎬 动态漫工作区
- 画面比例: 16:9 (1920×1080)
- 帧率: 24 fps
- 总时长: 2分30秒 (3600 帧)
- 分镜数: 35 个

**技术规格**:
- 软件: After Effects 2024
- 图层结构: 前景 + 中景 + 背景 + 特效
- 运镜: 2D 运镜 + 轻微 3D 效果
- 音频: 5.1 声道

---

## 分镜脚本

### 场景 1: 修炼室突破

**环境**: 室内,修炼室,夜晚
**氛围**: 紧张、神秘
**总时长**: 30 秒 (720 帧)
**分镜数**: 6 个

---

#### 【分镜 1.1】开场环境

**时间轴**: 00:00:00 - 00:00:05 (第 0-120 帧)
**景别**: 远景 (Extreme Long Shot)
**角度**: 俯视 30°

**画面内容**:
- 修炼室全景,昏暗的灯光
- 主角林辰盘坐在中央蒲团上
- 周围有蜡烛,营造神秘氛围

**图层结构**:
```
图层 1 (前景): 蜡烛火焰(带粒子效果)
图层 2 (中景): 主角林辰
图层 3 (背景): 修炼室墙壁、地面
图层 4 (特效): 光晕、氛围雾气
```

**运镜参数**:
- **类型**: 推镜 (Push In)
- **起始**: 远景(视野 90°)
- **结束**: 中景(视野 50°)
- **速度曲线**: Ease In (慢→快)
  - 0-60帧: 线性推进
  - 60-120帧: 加速推进
- **运动路径**: Z轴向前(模拟摄像机前进)

**3D 参数**:
- Camera Position: (0, 200, -500) → (0, 150, -200)
- Camera Rotation: (30°, 0°, 0°)
- FOV: 45°

**转场**: 无(直接切入)

**音频**:
- 音效: 环境音(修炼室回响)
- BGM: 神秘音乐,音量 40%

**AE 脚本导出**:
```javascript
// 镜头 1.1 - 推镜参数
var comp = app.project.activeItem;
var camera = comp.layers.addCamera("Camera_1_1", [960, 540]);

camera.position.setValueAtTime(0, [0, 200, -500]);
camera.position.setValueAtTime(5, [0, 150, -200]);
camera.position.setInterpolationTypeAtKey(1, KeyframeInterpolationType.BEZIER);
```

---

#### 【分镜 1.2】主角特写

**时间轴**: 00:00:05 - 00:00:08 (第 120-192 帧)
**景别**: 特写 (Close-Up)
**角度**: 正面平视

**画面内容**:
- 林辰脸部特写,闭眼,眉头紧皱
- 额头有汗珠滑落
- 背景完全虚化

**图层结构**:
```
图层 1 (前景): 汗珠(带运动模糊)
图层 2 (中景): 林辰脸部
图层 3 (背景): 虚化的修炼室(高斯模糊 50px)
```

**运镜参数**:
- **类型**: 静止 (Static)
- **微动**: 轻微抖动(模拟呼吸)
  - X轴: ±2px
  - Y轴: ±1px
  - 频率: 12次/秒(呼吸节奏)

**特效**:
- 汗珠动画: 从额头滑落到下巴(72帧)
- Glow 效果: 林辰皮肤微微发光(修炼能量)

**转场**: 无

**音频**:
- 音效: 呼吸声(加重)
- BGM: 音量提升至 60%

---

#### 【分镜 1.3】能量聚集

**时间轴**: 00:00:08 - 00:00:13 (第 192-312 帧)
**景别**: 中景 (Medium Shot)
**角度**: 侧面,微仰视 15°

**画面内容**:
- 林辰半身,双手结印
- 周围能量粒子开始汇聚
- 蓝色光芒逐渐增强

**图层结构**:
```
图层 1 (特效): 粒子系统(Particular插件)
  - 粒子数量: 0 → 1000
  - 粒子颜色: 蓝色渐变
  - 粒子运动: 向林辰手掌汇聚
图层 2 (中景): 林辰
图层 3 (背景): 修炼室
图层 4 (光效): 蓝色光晕(逐渐增强)
```

**运镜参数**:
- **类型**: 环绕 (Orbit)
- **起始角度**: 侧面 90°
- **结束角度**: 侧面 120°
- **旋转轴**: Y轴
- **速度**: 匀速
- **高度变化**: 微微上升(+10px)

**特效参数**:
- **粒子系统**:
  - Birth Rate: 0-120帧线性增加
  - Size: 2-5px 随机
  - Opacity: 50-100%
  - Life: 2秒
- **Glow**:
  - Intensity: 0 → 80%
  - Radius: 50px
  - Color: #00BFFF (蓝色)

**转场**: 无

**音效**:
- 粒子汇聚声(嗡嗡声,逐渐增强)
- 能量脉冲声(每 0.5秒一次)

**BGM**: 音量 50%,加入低频(营造紧张感)

---

#### 【分镜 1.4】突破瞬间

**时间轴**: 00:00:13 - 00:00:15 (第 312-360 帧)
**景别**: 特写 (Close-Up)
**角度**: 正面平视

**画面内容**:
- 林辰突然睁眼,眼神犀利
- 眼中闪过蓝光
- 能量爆发瞬间

**图层结构**:
```
图层 1 (特效): 冲击波(径向模糊)
图层 2 (特效): 闪光(Screen模式)
图层 3 (中景): 林辰脸部
图层 4 (背景): 白色(代表能量爆发)
```

**运镜参数**:
- **类型**: 快速推镜 + 震动
- **推镜**: 1帧内极速推进(模拟冲击)
- **震动**:
  - 幅度: X轴 ±20px, Y轴 ±15px
  - 时长: 48帧(2秒)
  - 衰减: 逐渐减弱

**特效参数**:
- **闪光**:
  - 第 312 帧: Opacity 100%(纯白)
  - 第 324 帧: Opacity 0%(淡出)
- **冲击波**:
  - 径向模糊: 0 → 50
  - 扩散: 从中心向外(300px半径)

**转场**: 闪白(Flash Transition)

**音效**:
- 巨大爆炸声(低频)
- 玻璃碎裂声(高频)
- 回音效果(Reverb)

**BGM**: 突然停止(制造冲击感)

---

#### 【分镜 1.5】冲击波扩散

**时间轴**: 00:00:15 - 00:00:20 (第 360-480 帧)
**景别**: 远景 (Extreme Long Shot)
**角度**: 俯视 45°

**画面内容**:
- 修炼室全景
- 蓝色冲击波从林辰身体向外扩散
- 蜡烛被吹灭,物体被推开

**图层结构**:
```
图层 1 (特效): 冲击波圆环(Shape Layer)
图层 2 (动画): 蜡烛火焰熄灭
图层 3 (动画): 物体位移(蒲团、书籍)
图层 4 (中景): 林辰
图层 5 (背景): 修炼室
```

**运镜参数**:
- **类型**: 拉镜 (Pull Out)
- **起始**: 中景
- **结束**: 远景
- **速度**: Ease Out (快→慢)

**特效参数**:
- **冲击波**:
  - 起始半径: 0px
  - 结束半径: 800px
  - Stroke Width: 10px → 2px
  - Opacity: 100% → 0%
  - Color: #00BFFF
- **物体位移**:
  - 使用表达式: wiggle(5, 20)
  - 方向: 远离中心

**转场**: 无

**音效**:
- 冲击波扩散声(Whoosh)
- 物体掉落声(Foley)

**BGM**: 重新开始,胜利音乐,音量 70%

---

#### 【分镜 1.6】林辰站起

**时间轴**: 00:00:20 - 00:00:30 (第 480-720 帧)
**景别**: 全景 (Full Shot)
**角度**: 平视

**画面内容**:
- 林辰缓缓站起
- 身体周围还有残余的蓝色能量
- 表情从紧张转为自信

**图层结构**:
```
图层 1 (特效): 残余能量粒子
图层 2 (中景): 林辰(带骨骼动画)
图层 3 (背景): 修炼室
```

**运镜参数**:
- **类型**: 跟镜 (Follow)
- **跟随目标**: 林辰的头部
- **速度**: 与林辰动作同步
- **Smoothing**: 80%(轻微延迟,更自然)

**角色动画**:
- 0-120帧: 蹲姿 → 半蹲
- 120-240帧: 半蹲 → 站立
- 240-480帧: 站立(呼吸动画)

**转场**: 淡出到黑屏(Fade to Black)

**音效**:
- 衣服摩擦声
- 脚步声

**BGM**: 逐渐淡出

---

## 导出配置

### AE 项目结构

```
Project: 都市修仙传_第1话
├── Compositions/
│   ├── Scene_01_修炼室突破 (1920x1080, 24fps, 30s)
│   │   ├── Shot_1_1 (Pre-comp)
│   │   ├── Shot_1_2 (Pre-comp)
│   │   ├── Shot_1_3 (Pre-comp)
│   │   ├── Shot_1_4 (Pre-comp)
│   │   ├── Shot_1_5 (Pre-comp)
│   │   └── Shot_1_6 (Pre-comp)
│   └── ...
├── Footage/
│   ├── Characters/林辰.psd
│   ├── Backgrounds/修炼室.jpg
│   └── Effects/粒子素材/
└── Audio/
    ├── BGM/神秘音乐.mp3
    ├── SFX/冲击波.wav
    └── Voiceover/配音.wav
```

### 导出脚本 (AE JSX)

```javascript
// Scriptify 自动生成 - 都市修仙传_第1话

// 创建场景1
var scene1 = app.project.items.addComp("Scene_01", 1920, 1080, 1, 30, 24);

// 分镜 1.1
var shot1_1 = app.project.items.addComp("Shot_1_1", 1920, 1080, 1, 5, 24);
var camera1_1 = shot1_1.layers.addCamera("Camera", [960, 540]);

// 运镜动画
camera1_1.position.setValueAtTime(0, [0, 200, -500]);
camera1_1.position.setValueAtTime(5, [0, 150, -200]);

// 图层导入
var layer_bg = shot1_1.layers.add(app.project.importFile("修炼室.jpg"));
var layer_char = shot1_1.layers.add(app.project.importFile("林辰.psd"));

// ... 更多分镜配置
```

---

## 技术备注

**插件需求**:
- Trapcode Particular (粒子系统)
- Optical Flares (光效)
- Motion Bro (运镜预设)

**渲染设置**:
- 格式: H.264
- 分辨率: 1920×1080
- 帧率: 24fps
- 比特率: 10 Mbps

**文件命名**:
- 分镜: Shot_{场景号}_{镜头号}.aep
- 素材: {类型}_{名称}.{扩展名}
```

### 5.3 工作区特有字段

**动态漫工作区专属**:

| 字段 | 说明 | 示例 |
|------|------|------|
| `帧数范围` | 精确到帧的时间范围 | 第 0-120 帧 |
| `图层结构` | 前景/中景/背景/特效 | 见示例 |
| `运镜参数` | 类型、速度曲线、路径 | 推镜,Ease In |
| `3D 参数` | 相机位置、旋转、FOV | (0,200,-500) |
| `特效参数` | 粒子、光效、模糊等 | Particular,Glow |
| `转场` | 镜头过渡效果 | 淡入/淡出/闪白 |
| `AE 脚本` | 导出的 JSX 代码 | 见示例 |

### 5.4 配置参数

**动态漫工作区配置** (`workspaces/motion/config.json`):

```json
{
  "workspace": "motion",
  "platform": "ae",
  "aspectRatio": "16:9",
  "resolution": "1920x1080",
  "fps": 24,

  "layerStructure": {
    "foreground": true,
    "midground": true,
    "background": true,
    "effects": true
  },

  "cameraSettings": {
    "type": "2D" | "3D",
    "fov": 45,
    "nearClip": 0.1,
    "farClip": 10000
  },

  "exportFormats": [
    "markdown",
    "ae-jsx",
    "pr-xml",
    "剪映-json",
    "json-api"
  ]
}
```

### 5.5 命令适配

**动态漫工作区专属命令**:

```bash
# 配置运镜
$ scriptify /camera --shot 1 --type push-in --speed ease-in

# 添加图层
$ scriptify /layer --shot 3 --type foreground --file "粒子.png"

# 配置特效
$ scriptify /effect --shot 4 --type glow --intensity 80

# 导出 AE 脚本
$ scriptify /export --format ae-jsx

# 生成项目结构
$ scriptify /export --format project-structure
```

---

## 六、工作区路由与自动检测

### 6.1 工作区配置文件

**全局配置** (`spec/workspace-config.json`):

```json
{
  "version": "1.0",
  "workspaces": {
    "comic": {
      "name": "漫画工作区",
      "platforms": ["kuaikan", "tengxun", "weibo"],
      "icon": "📱"
    },
    "short-video": {
      "name": "短视频工作区",
      "platforms": ["douyin", "kuaishou", "bilibili"],
      "icon": "📹"
    },
    "motion": {
      "name": "动态漫工作区",
      "platforms": ["ae", "pr", "剪映", "达芬奇"],
      "icon": "🎬"
    }
  },

  "autoDetection": {
    "priority": [
      "user-explicit",
      "brief-platform-field",
      "project-config",
      "script-analysis",
      "fallback"
    ],
    "rules": {
      "platformMapping": {
        "kuaikan": "comic",
        "腾讯动漫": "comic",
        "douyin": "short-video",
        "抖音": "short-video",
        "ae": "motion",
        "剪映": "motion"
      },
      "scriptFeatures": {
        "hasTimeline": "short-video",
        "has3DCamera": "motion",
        "hasPaging": "comic"
      }
    },
    "fallback": "comic"
  }
}
```

### 6.2 自动检测实现

```typescript
// src/workspace/detector.ts

interface DetectionResult {
  workspace: 'comic' | 'short-video' | 'motion';
  confidence: number;
  reason: string;
}

class WorkspaceDetector {
  detect(project: Project): DetectionResult {
    // 1. 用户显式指定
    if (project.userSpecified) {
      return {
        workspace: project.userSpecified,
        confidence: 1.0,
        reason: '用户手动指定'
      };
    }

    // 2. Brief 中的 platform 字段
    if (project.brief?.platform) {
      const mapped = this.platformMapping[project.brief.platform];
      if (mapped) {
        return {
          workspace: mapped,
          confidence: 0.9,
          reason: `Brief中指定平台: ${project.brief.platform}`
        };
      }
    }

    // 3. 分析剧本特征
    const features = this.analyzeScript(project.script);
    if (features.hasTimeline && features.verticalRatio) {
      return {
        workspace: 'short-video',
        confidence: 0.8,
        reason: '剧本包含时间轴和竖屏标注'
      };
    }

    // 4. 默认
    return {
      workspace: 'comic',
      confidence: 0.5,
      reason: '默认漫画工作区'
    };
  }

  private analyzeScript(script: string): ScriptFeatures {
    return {
      hasTimeline: /\d{2}:\d{2}/.test(script),
      has3DCamera: /camera.*position/i.test(script),
      hasPaging: /翻页|第\d+页/.test(script),
      verticalRatio: /9:16|竖屏/.test(script)
    };
  }
}
```

---

## 七、工作区切换

### 7.1 切换机制

**用户可以随时切换工作区,Scriptify 会自动转换格式**:

```bash
$ scriptify /switch-workspace --to short-video

【AI】: 检测到你当前使用【漫画工作区】,切换到【短视频工作区】将:

   ✅ 保留: 分镜内容、对话、运镜
   🔄 转换:
      - 添加时间轴标注(估算每镜时长)
      - 转换为竖屏构图(9:16)
      - 删除翻页标注
      - 添加字幕样式
      - 添加 BGM 配置

   ⚠️  可能丢失:
      - 气泡位置(字幕不需要)
      - 分页信息

继续切换?(Y/n) Y

⏳ 转换中... (预计 10秒)

✅ 已切换到【短视频工作区】
✅ 已重新生成 28 个分镜的时间轴
✅ 已添加字幕配置

请使用 /preview 查看转换结果
```

### 7.2 转换规则

```typescript
interface ConversionRules {
  from: Workspace;
  to: Workspace;
  mappings: FieldMapping[];
  additions: string[];
  removals: string[];
}

const conversionRules: ConversionRules[] = [
  {
    from: 'comic',
    to: 'short-video',
    mappings: [
      { source: '分镜号', target: '镜头号', transform: (v) => v },
      { source: '对话', target: '字幕', transform: (v) => v },
      { source: '景别', target: '景别', transform: (v) => v }
    ],
    additions: ['时间轴', '时长', '配音', 'BGM'],
    removals: ['翻页位置', '气泡位置', '页数估算']
  },
  // ... 更多转换规则
];
```

---

## 八、总结

### 8.1 三工作区特点对比

| 特点 | 漫画 | 短视频 | 动态漫 |
|------|------|--------|--------|
| **核心目标** | 分镜叙事 | 短时吸引 | 技术实现 |
| **时间概念** | 无 | 秒级 | 帧级 |
| **专业度** | 中 | 低 | 高 |
| **学习成本** | 中 | 低 | 高 |
| **导出复杂度** | 低 | 中 | 高 |

### 8.2 下一步

- [x] **PRD-03**: 三工作区系统 (本文档)
- [ ] **PRD-04**: 完整创作流程
- [ ] **PRD-05**: 素材库系统
- [ ] **PRD-06**: 分镜脚本规范
- [ ] **PRD-07**: 多平台命令生成

---

**文档版本历史**:
- v1.0 (2025-10-29): 初始版本,定义三工作区系统
